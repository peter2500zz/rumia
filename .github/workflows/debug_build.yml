name: Build debug version

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    # 1. 修改运行环境为 Windows
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    # 2. 必须手动安装 32位 MSVC target，因为 windows-latest 默认是 64位
    - name: Add i686 target
      run: rustup target add i686-pc-windows-msvc

    # 3. 编译时指定 target (默认为 Debug 模式，不需要加 --release)
    - name: Build
      run: cargo build --verbose --target i686-pc-windows-msvc

    # 4. 运行测试，同样需要指定 target
    - name: Run tests
      run: cargo test --verbose --target i686-pc-windows-msvc

    # 5. 上传 DLL 文件作为 Artifact
    - name: Upload DLLs
      uses: actions/upload-artifact@v4
      with:
        name: debug-dlls-i686
        # 使用 glob 模式匹配所有 .dll 文件
        path: target/i686-pc-windows-msvc/debug/*.dll
        # 如果没有找到 DLL 文件，发出警告而不是报错 (可选配置)
        if-no-files-found: warn
